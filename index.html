<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madagascar Mall | Official Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: "Times New Roman", Times, serif; scroll-behavior: smooth; background-color: #ffffff; color: #000; }
        .gold-accent { color: #D4AF37; }
        .search-bar { border: 1px solid #000; outline: none; }
        .search-bar:focus { border-color: #D4AF37; }
        .whatsapp-float { position: fixed; bottom: 30px; right: 30px; background-color: #25d366; color: white; padding: 12px 20px; border-radius: 4px; z-index: 100; font-weight: bold; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-size: 11px; tracking: 0.1em; }
        .hidden { display: none; }
        input, textarea { border-bottom: 1px solid #000; padding: 10px; outline: none; width: 100%; background: transparent; }
        input:focus, textarea:focus { border-color: #D4AF37; }
        .review-card { border-left: 1px solid #000; padding-left: 20px; margin-bottom: 30px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <a href="https://wa.me/254742152821" target="_blank" class="whatsapp-float uppercase tracking-widest">Contact Support</a>

    <nav class="p-6 border-b border-black sticky top-0 bg-white z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-center md:text-left">
                <h1 class="text-4xl font-bold uppercase leading-none tracking-tighter">MADAGASCAR <span class="gold-accent">MALL</span></h1>
                <p class="text-[9px] tracking-[0.4em] uppercase font-bold text-zinc-400 mt-1">Official Business Environment</p>
            </div>
            
            <div class="flex-1 max-w-lg flex border border-black overflow-hidden">
                <input type="text" placeholder="Search shops or services..." class="w-full px-4 py-2 border-none text-sm">
                <button class="bg-black text-white px-6 py-2 font-bold uppercase text-[10px] tracking-widest">Search</button>
            </div>

            <div class="flex gap-8 text-xs font-bold uppercase tracking-widest">
                <a href="#" onclick="showPage('main')" class="hover:gold-accent">Home</a>
                <a href="#" onclick="showPage('reviews')" class="hover:gold-accent">Reviews</a>
                <a href="#" onclick="showPage('portal')" class="hover:gold-accent underline">Account</a>
            </div>
        </div>
    </nav>

    <div id="page-main">
        <section class="max-w-6xl mx-auto py-20 px-6">
            <div class="grid md:grid-cols-2 gap-16 items-start">
                <div>
                    <h2 class="text-6xl font-bold italic mb-8 leading-tight">Industrial Excellence.<br>Nairobi, Kenya.</h2>
                    <p class="text-lg leading-relaxed text-zinc-700 mb-6">
                        Located in the heart of Embakasi, Madagascar Mall is a premier destination for modern business. 
                        Housing flagship stores like <strong>Jus'Praktikal Beds & Home</strong>, we provide a 
                        sophisticated environment for both retailers and customers.
                    </p>
                    <p class="font-bold text-sm">T: 0742 152821 | Open: 08:00 - 20:00 Daily</p>
                </div>
                <div class="bg-zinc-50 p-10 border border-zinc-200">
                    <h4 class="font-bold uppercase text-xs gold-accent tracking-widest mb-6 border-b border-zinc-200 pb-2">Facility Specifications</h4>
                    <div class="space-y-4 text-sm font-medium">
                        <p> Wheelchair-accessible car park</p>
                        <p> Wheelchair-accessible entrance</p>
                        <p> Wheelchair-accessible toilet</p>
                        <p> Arcade games & Family Amenities</p>
                        <p> On-site Services & Security</p>
                        <p> Payments: Credit/Debit/NFC/M-Pesa</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-zinc-100 py-20 border-y border-black">
            <div class="max-w-7xl mx-auto px-6">
                <h3 class="text-center text-3xl font-bold mb-12 uppercase italic">Visual Showcase</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <script>
                        for(let i=1; i<=10; i++) {
                            document.write(`<div class="aspect-[3/4] bg-white border border-black p-1"><img src="images/m${i}.jpg" alt="Mall View ${i}" class="w-full h-full object-cover grayscale hover:grayscale-0 transition duration-700"></div>`);
                        }
                    </script>
                </div>
            </div>
        </section>
    </div>

    <div id="page-reviews" class="hidden max-w-4xl mx-auto py-20 px-6">
        <h2 class="text-4xl font-bold uppercase mb-12 italic tracking-tighter">Community Feedback</h2>
        
        <div id="review-input-zone" class="mb-16 p-10 border border-black bg-zinc-50 hidden">
            <h4 class="text-xs font-bold uppercase mb-6 tracking-widest">Share Your Experience</h4>
            <textarea id="rev-text" placeholder="Write your verified review here..." class="mb-8 h-32"></textarea>
            <button onclick="saveReview()" class="bg-black text-white px-12 py-4 font-bold uppercase text-xs tracking-widest">Submit Review</button>
        </div>

        <div id="login-to-post" class="mb-16 p-12 text-center border border-dashed border-zinc-300">
            <p class="text-xs uppercase tracking-[0.3em] text-zinc-400">Authenticated login required to post</p>
            <button onclick="showPage('portal')" class="mt-6 font-bold underline gold-accent uppercase text-xs">Access Portal</button>
        </div>

        <div id="review-list" class="space-y-12">
            </div>
    </div>

    <div id="page-portal" class="hidden max-w-md mx-auto py-24 px-6">
        <div id="auth-container" class="border border-black p-12 text-center bg-white shadow-2xl">
            <h3 id="auth-title" class="text-3xl font-bold mb-10 uppercase italic">Mall Portal</h3>
            <input id="auth-email" type="email" placeholder="EMAIL ADDRESS" class="mb-8">
            <input id="auth-pass" type="password" placeholder="PASSWORD" class="mb-12">
            
            <button id="auth-btn" onclick="handleAuth()" class="w-full bg-black text-white py-5 font-bold uppercase text-xs tracking-widest mb-6">Sign In</button>
            
            <p class="text-[10px] tracking-widest uppercase">
                <span id="toggle-text">New Member?</span> 
                <a href="#" onclick="toggleAuthMode()" id="toggle-link" class="underline font-bold gold-accent ml-2">Sign Up</a>
            </p>
            <p id="auth-error" class="text-red-600 text-[10px] mt-6 uppercase font-bold"></p>
        </div>

        <div id="user-dashboard" class="hidden text-center p-16 border border-black bg-zinc-50">
            <h3 class="text-2xl font-bold mb-4 uppercase italic">Verified Access</h3>
            <p id="user-email-display" class="text-xs mb-12 text-zinc-500"></p>
            <button onclick="handleLogout()" class="border border-black px-10 py-3 uppercase text-[10px] font-bold hover:bg-black hover:text-white transition">Sign Out</button>
        </div>
    </div>

    <footer class="bg-black text-zinc-500 p-16 text-[10px] mt-auto font-bold uppercase tracking-[0.3em]">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16">
            <div>
                <h4 class="text-white mb-6 border-b border-zinc-800 pb-2">Legal & Privacy</h4>
                <p class="normal-case font-light leading-relaxed text-zinc-400 max-w-sm">
                    We use functional cookies for session management and security. By posting a review, you agree to our community guidelines. All personal data is handled under strict security protocols.
                </p>
            </div>
            <div class="md:text-right">
                <p>Unnamed Road, Embakasi | Nairobi, KE</p>
                <p class="gold-accent mt-2">0742 152821</p>
                <p class="mt-12 text-zinc-800">© 2025 Madagascar Mall • Peak Solutions</p>
            </div>
        </div>
    </footer>

    <script>
        const SUPABASE_URL = 'https://omekzoprrhdrrqahekma.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_fs6rz6eyYkkg8N7AUi7IKg_On2b01mK';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let isSignUpMode = false;

        function toggleAuthMode() {
            isSignUpMode = !isSignUpMode;
            document.getElementById('auth-title').innerText = isSignUpMode ? "Create Account" : "Mall Portal";
            document.getElementById('auth-btn').innerText = isSignUpMode ? "Register" : "Sign In";
            document.getElementById('toggle-text').innerText = isSignUpMode ? "Registered?" : "New Member?";
            document.getElementById('toggle-link').innerText = isSignUpMode ? "Login" : "Sign Up";
        }

        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-pass').value;
            const errorEl = document.getElementById('auth-error');
            errorEl.innerText = "";

            if (isSignUpMode) {
                const { error } = await supabaseClient.auth.signUp({ email, password });
                if (error) errorEl.innerText = error.message;
                else alert("Account created! Please verify your email if required, then sign in.");
            } else {
                const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
                if (error) errorEl.innerText = error.message;
                else checkUser();
            }
        }

        async function checkUser() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (user) {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('user-dashboard').classList.remove('hidden');
                document.getElementById('user-email-display').innerText = user.email;
                document.getElementById('review-input-zone').classList.remove('hidden');
                document.getElementById('login-to-post').classList.add('hidden');
            } else {
                document.getElementById('auth-container').classList.remove('hidden');
                document.getElementById('user-dashboard').classList.add('hidden');
                document.getElementById('review-input-zone').classList.add('hidden');
                document.getElementById('login-to-post').classList.remove('hidden');
            }
        }

        async function saveReview() {
            const text = document.getElementById('rev-text').value;
            const { data: { user } } = await supabaseClient.auth.getUser();
            if(!text || !user) return;

            const { error } = await supabaseClient.from('reviews').insert([
                { name: user.email.split('@')[0], comment: text }
            ]);

            if(!error) {
                document.getElementById('rev-text').value = '';
                loadReviews();
            } else { alert("Error posting. Check your Supabase RLS policies."); }
        }

        async function loadReviews() {
            const list = document.getElementById('review-list');
            list.innerHTML = "<p class='italic text-xs tracking-widest text-zinc-400 uppercase'>Syncing reviews...</p>";
            
            const { data, error } = await supabaseClient
                .from('reviews')
                .select('*')
                .order('created_at', { ascending: false });

            if(data) {
                list.innerHTML = data.map(r => `
                    <div class="review-card">
                        <p class="font-bold uppercase text-[10px] tracking-[0.4em] gold-accent mb-2">${r.name}</p>
                        <p class="italic text-lg text-zinc-800 font-medium">"${r.comment}"</p>
                    </div>`).join('');
            }
        }

        async function handleLogout() {
            await supabaseClient.auth.signOut();
            checkUser();
        }

        function showPage(pageId) {
            ['main', 'reviews', 'portal'].forEach(p => document.getElementById('page-' + p).classList.add('hidden'));
            document.getElementById('page-' + pageId).classList.remove('hidden');
            if(pageId === 'reviews') loadReviews();
            window.scrollTo(0,0);
        }

        checkUser();
    </script>
</body>
</html>
